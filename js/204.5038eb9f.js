"use strict";(self["webpackChunke_commerce"]=self["webpackChunke_commerce"]||[]).push([[204],{3204:function(t,e,a){a.r(e),a.d(e,{default:function(){return _t}});var s=a(3396),l=a(7139),o=a(9242),i=a(556);const r=t=>((0,s.dD)("data-v-45d06b9a"),t=t(),(0,s.Cn)(),t),n={key:0,class:"bg-white py-5"},d=r((()=>(0,s._)("h3",{class:"m-2 m-md-5 text-warning"},[(0,s._)("i",{class:"bi bi-box2-heart me-1"}),(0,s.Uk)(" 購物車清單 ")],-1))),c={class:"col-4 col-lg-2"},p=["src","alt"],m={class:"col-6 d-flex flex-column justify-content-between px-1 px-md-4 body"},u={class:"d-flex justify-content-between align-items-center m-0 p-0"},h={class:"mb-0"},f=["onClick"],g=r((()=>(0,s._)("i",{class:"bi bi-x"},null,-1))),w=[g],_={class:"d-flex justify-content-between align-items-center"},y={for:"amount",class:"d-flex align-items-center"},b=["onClick"],C=r((()=>(0,s._)("i",{class:"bi bi-dash"},null,-1))),x=[C],$=["onUpdate:modelValue"],v=["onClick"],k=r((()=>(0,s._)("i",{class:"bi bi-plus"},null,-1))),U=[k],D={class:"text-nowrap text-warning"},V={class:"d-flex justify-content-end align-items-center mb-2 fs-3"},M=r((()=>(0,s._)("strong",{class:"me-2 me-md-5 text-nowrap"},"總計 :",-1))),S={key:0,class:"me-5 text-nowrap text-danger"},j={key:1,class:"fs-5 me-5 text-nowrap text-dark text-decoration-line-through"},W={key:0,class:"d-flex justify-content-end align-items-center fs-3"},q=r((()=>(0,s._)("strong",{class:"me-2 me-md-5 text-nowrap"},"折扣價 :",-1))),O={class:"me-5 text-nowrap text-danger"},Z={class:"input-group my-4 input-group-sm d-flex justify-content-end pe-4"},z={for:"couponCode"},E={class:"input-group-append"},I=r((()=>(0,s._)("h3",{class:"m-2 m-md-5"},[(0,s.Uk)("猜你喜歡"),(0,s._)("i",{class:"bi bi-heart ms-2 text-danger"})],-1))),L={class:"row row-cols-2 row-cols-md-3 row-cols-xl-6 g-3 mb-5 mx-0 mx-md-4"},F={class:"card h-100"},P=["src","alt"],H={class:"card-body d-flex flex-column justify-content-between"},Y={class:"card-title"},K=["onClick"],R={class:"card-text d-flex justify-content-between align-items-center"},T={class:"text-dark text-decoration-line-through"},A={class:"text-danger fw-bold"},B={class:"row justify-content-center"},G={class:"form-floating mb-3"},J=r((()=>(0,s._)("label",{for:"floatingInput"},"Email",-1))),N={class:"form-floating mb-3"},Q=r((()=>(0,s._)("label",{for:"name"},"收件人姓名",-1))),X={class:"form-floating mb-3"},tt=r((()=>(0,s._)("label",{for:"tel"},"收件人電話",-1))),et={class:"form-floating mb-3"},at=r((()=>(0,s._)("label",{for:"address"},"收件人地址",-1))),st={class:"form-floating"},lt=r((()=>(0,s._)("label",{for:"floatingTextarea"},"留言",-1))),ot=r((()=>(0,s._)("div",{class:"mt-5"},[(0,s._)("div",{class:"text-end"},[(0,s._)("button",{type:"submit",class:"btn btn-outline-info"},"送出訂單 ")])],-1))),it={key:1,class:"bg-white py-5 d-flex flex-column justify-content-center align-items-center"},rt=r((()=>(0,s._)("p",{class:"fs-5"},"你的購物車還是空的",-1))),nt=(0,s.Uk)(" 去逛逛主子喜歡甚麼 "),dt=r((()=>(0,s._)("i",{class:"bi bi-hearts"},null,-1))),ct=r((()=>(0,s._)("span",null,[(0,s._)("img",{class:"cartCat",src:i,alt:"cat"})],-1)));function pt(t,e,a,i,r,g){const C=(0,s.up)("Loading"),k=(0,s.up)("v-field"),pt=(0,s.up)("error-message"),mt=(0,s.up)("v-form"),ut=(0,s.up)("router-link"),ht=(0,s.up)("DelModal");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(C,{loading:r.isLoading},null,8,["loading"]),0!==r.shoppingCarts.total?((0,s.wg)(),(0,s.iD)("div",n,[d,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.shoppingCarts.carts,(e=>((0,s.wg)(),(0,s.iD)("div",{class:"row justify-content-center mb-4 g-0",key:e.id},[(0,s._)("div",c,[(0,s._)("img",{src:e.product.imageUrl,alt:e.product.title},null,8,p)]),(0,s._)("div",m,[(0,s._)("div",u,[(0,s._)("h4",h,(0,l.zw)(e.product.title),1),(0,s._)("button",{class:"symbol fs-2 fw-bold delete",onClick:t=>g.openDelCartModal(e)},w,8,f)]),(0,s._)("div",_,[(0,s._)("label",y,[(0,s._)("button",{class:"symbol",onClick:t=>g.updateCart(e,-1)},x,8,b),(0,s.wy)((0,s._)("input",{class:"text-center amount",type:"number",disabled:"","onUpdate:modelValue":t=>e.qty=t},null,8,$),[[o.nr,e.qty]]),(0,s._)("button",{class:"symbol",onClick:t=>g.updateCart(e,1)},U,8,v)]),(0,s._)("strong",D,"$ "+(0,l.zw)(t.$filters.currency(e.final_total)),1)])])])))),128)),(0,s._)("div",V,[M,r.shoppingCarts.total===r.shoppingCarts.final_total?((0,s.wg)(),(0,s.iD)("strong",S," $ "+(0,l.zw)(t.$filters.currency(r.shoppingCarts.total)),1)):((0,s.wg)(),(0,s.iD)("strong",j," $ "+(0,l.zw)(t.$filters.currency(r.shoppingCarts.total)),1))]),r.shoppingCarts.total!==r.shoppingCarts.final_total?((0,s.wg)(),(0,s.iD)("div",W,[q,(0,s._)("strong",O," $ "+(0,l.zw)(t.$filters.currency(r.shoppingCarts.final_total)),1)])):(0,s.kq)("",!0),(0,s._)("div",Z,[(0,s._)("label",z,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control couponCode",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[0]||(e[0]=t=>r.code=t)},null,512),[[o.nr,r.code]])]),(0,s._)("div",E,[(0,s._)("button",{class:"btn btn-outline-info",type:"button",onClick:e[1]||(e[1]=(...t)=>g.applyCoupon&&g.applyCoupon(...t))}," 套用優惠碼 ")])]),I,(0,s._)("div",L,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.random,(e=>((0,s.wg)(),(0,s.iD)("div",{class:"col",key:e.id},[(0,s._)("div",F,[(0,s._)("img",{class:"card-img-top d-flex flex-column justify-content-between cartCard",src:e.imageUrl,alt:e.title},null,8,P),(0,s._)("div",H,[(0,s._)("h5",Y,[(0,s._)("a",{href:"#",class:"stretched-link style",onClick:(0,o.iM)((t=>g.getProduct(e.id)),["prevent"])},(0,l.zw)(e.title),9,K)]),(0,s._)("div",R,[(0,s._)("span",T," $"+(0,l.zw)(t.$filters.currency(e.origin_price)),1),(0,s._)("span",A," $"+(0,l.zw)(t.$filters.currency(e.price)),1)])])])])))),128))]),(0,s._)("div",B,[(0,s.Wm)(mt,{class:"form-floating col-8 col-md-5",onSubmit:g.sendOrder},{default:(0,s.w5)((({errors:t})=>[(0,s._)("div",G,[(0,s.Wm)(k,{type:"email",class:(0,l.C_)(["form-control",{"is-invalid":t["email"]}]),id:"floatingInput",placeholder:"請輸入 Email",name:"email",rules:"email|required",modelValue:r.form.user.email,"onUpdate:modelValue":e[2]||(e[2]=t=>r.form.user.email=t)},null,8,["class","modelValue"]),J,(0,s.Wm)(pt,{class:"invalid-feedback",name:"email"})]),(0,s._)("div",N,[(0,s.Wm)(k,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":t["姓名"]}]),id:"name",placeholder:"請輸入 姓名",name:"姓名",rules:"required",modelValue:r.form.user.name,"onUpdate:modelValue":e[3]||(e[3]=t=>r.form.user.name=t)},null,8,["class","modelValue"]),Q,(0,s.Wm)(pt,{class:"invalid-feedback",name:"姓名"})]),(0,s._)("div",X,[(0,s.Wm)(k,{type:"number",class:(0,l.C_)(["form-control",{"is-invalid":t["電話"]}]),id:"tel",placeholder:"請輸入 電話",name:"電話",rules:"min:10|required",modelValue:r.form.user.tel,"onUpdate:modelValue":e[4]||(e[4]=t=>r.form.user.tel=t)},null,8,["class","modelValue"]),tt,(0,s.Wm)(pt,{class:"invalid-feedback",name:"電話"})]),(0,s._)("div",et,[(0,s.Wm)(k,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":t["地址"]}]),id:"address",placeholder:"請輸入 地址",name:"地址",rules:"required",modelValue:r.form.user.address,"onUpdate:modelValue":e[5]||(e[5]=t=>r.form.user.address=t)},null,8,["class","modelValue"]),at,(0,s.Wm)(pt,{class:"invalid-feedback",name:"地址"})]),(0,s._)("div",st,[(0,s.wy)((0,s._)("textarea",{class:"form-control",placeholder:"留言",id:"floatingTextarea","onUpdate:modelValue":e[6]||(e[6]=t=>r.form.message=t)},null,512),[[o.nr,r.form.message]]),lt,ot])])),_:1},8,["onSubmit"])])])):((0,s.wg)(),(0,s.iD)("div",it,[rt,(0,s.Wm)(ut,{class:"btn btn-outline-warning mb-4",to:"/user/list"},{default:(0,s.w5)((()=>[nt,dt])),_:1}),ct])),(0,s.Wm)(ht,{item:r.tempSoppingCart,ref:"delModal",onDelItem:g.delCart},null,8,["item","onDelItem"])],64)}a(1703);var mt=a(6076),ut=a(2734),ht=a(1870),ft={data(){return{isLoading:!1,shoppingCarts:{},tempSoppingCart:{},products:[],random:[],code:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{DelModal:mt.Z,Loading:ht.Z},methods:{async getShoppingCarts(){try{const t=`${this.$apiUrl}/cart`;this.isLoading=!0;const e=await this.$http.get(t);if(!e.data.success)throw new Error("updateOrderFailed");this.shoppingCarts=e.data.data}catch(t){(0,ut.Z)(this.$alert,t.message)}finally{this.isLoading=!1}},async getShoppingProducts(){try{const t=`${this.$apiUrl}/products/all`;this.isLoading=!0;const e=await this.$http.get(t);if(!e.data.success)throw new Error("updateOrderFailed");this.products=e.data.products}catch(t){(0,ut.Z)(this.$alert,t.message)}finally{this.isLoading=!1}},async updateCart(t,e){try{const a=t.qty+e;if(a<1)await this.openDelCartModal(t);else if(a>10)this.$alert("同一商品最大購買數為10");else{const e=`${this.$apiUrl}/cart/${t.id}`,s={product_id:t.product_id,qty:a},l=await this.$http.put(e,{data:s});if(!l.data.success)throw new Error("updateOrderFailed")}}catch(a){(0,ut.Z)(this.$alert,a.message)}finally{await this.getShoppingCarts()}},openDelCartModal(t){this.tempSoppingCart={...t.product},this.tempSoppingCart.cartId=t.id;const e=this.$refs.delModal;e.showModal()},async delCart(){try{const t=`${this.$apiUrl}/cart/${this.tempSoppingCart.cartId}`,e=await this.$http.delete(t);if(!e.data.success)throw new Error("updateOrderFailed");await this.getShoppingCarts()}catch(t){(0,ut.Z)(this.$alert,t.message)}finally{const t=this.$refs.delModal;t.hideModal()}},async applyCoupon(){try{if(!this.code)return void this.$alert("優惠券代碼不可為空白");const t=`${this.$apiUrl}/coupon`,e=await this.$http.post(t,{data:{code:this.code}});if(!e.data.success)throw new Error("updateOrderFailed");this.code="",await this.getShoppingCarts()}catch(t){(0,ut.Z)(this.$alert,t.message)}},async sendOrder(){try{const t=`${this.$apiUrl}/order`,e=await this.$http.post(t,{data:this.form});if(!e.data.success)throw new Error("updateOrderFailed");this.$router.push(`/user/checkout/${e.data.orderId}`)}catch(t){(0,ut.Z)(this.$alert,t.message)}},getRandom(){const{carts:t}=this.shoppingCarts,e=["feed","canned","toy"];for(let a=0;a<t.length;a+=1){const{category:s}=t[a].product,l=e.indexOf(s);if(-1!==l&&e.splice(a,1),0===e.length)break}for(let a=0;a<e.length;a+=1){const t=e[a],s=this.products.filter((e=>e.category===t));for(let e=0;e<2;e+=1){const t=Math.floor(Math.random()*s.length);this.random.push(s[t]),s.splice(t,1)}}if(this.random.length<6)for(let a=0;this.random.length<6;a+=1){const t=Math.floor(Math.random()*this.products.length),e=this.products[t];this.random.includes(e)||this.random.push(e),this.products.splice(t,1)}},getProduct(t){this.$router.push(`/user/product/${t}`)}},async mounted(){await Promise.all([this.getShoppingCarts(),this.getShoppingProducts()]),this.getRandom()}},gt=a(89);const wt=(0,gt.Z)(ft,[["render",pt],["__scopeId","data-v-45d06b9a"]]);var _t=wt},556:function(t,e,a){t.exports=a.p+"img/CartCat.d37f6f86.jpg"}}]);
//# sourceMappingURL=204.5038eb9f.js.map