"use strict";(self["webpackChunke_commerce"]=self["webpackChunke_commerce"]||[]).push([[325],{1979:function(e,t,a){a.d(t,{Z:function(){return h}});var l=a(3396),s=a(7139),o=a(9242);const i={"aria-label":"Page navigation example"},r={class:"pagination justify-content-center mb-0 pb-3"},d=(0,l._)("span",{"aria-hidden":"true"},"«",-1),n=[d],c=["onClick"],u=(0,l._)("span",{"aria-hidden":"true"},"»",-1),m=[u];function p(e,t,a,d,u,p){return(0,l.wg)(),(0,l.iD)("nav",i,[(0,l._)("ul",r,[(0,l._)("li",{class:(0,s.C_)(["page-item",{disabled:!a.pages.has_pre}])},[(0,l._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,o.iM)((t=>e.$emit("emit-pages",a.pages.current_page-1)),["prevent"]))},n)],2),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.pages.total_pages,(t=>((0,l.wg)(),(0,l.iD)("li",{class:(0,s.C_)(["page-item",{active:t===a.pages.current_page}]),key:t},[(0,l._)("a",{class:"page-link",href:"#",onClick:(0,o.iM)((a=>e.$emit("emit-pages",t)),["prevent"])},(0,s.zw)(t),9,c)],2)))),128)),(0,l._)("li",{class:(0,s.C_)(["page-item",{disabled:!a.pages.has_next}])},[(0,l._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,o.iM)((t=>e.$emit("emit-pages",a.pages.current_page+1)),["prevent"]))},m)],2)])])}var g={props:["pages"]},b=a(89);const _=(0,b.Z)(g,[["render",p]]);var h=_},8325:function(e,t,a){a.r(t),a.d(t,{default:function(){return he}});var l=a(3396),s=a(7139);const o={class:"text-end"},i={class:"table mt-4"},r=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",{width:"70"},"分類"),(0,l._)("th",null,"標題"),(0,l._)("th",{width:"115"},"原價"),(0,l._)("th",{width:"115"},"售價"),(0,l._)("th",{width:"100"},"是否啟用"),(0,l._)("th",{"max-width":"180",class:"d-none d-sm-block border-0"},"編輯")])],-1),d={class:"text-right"},n={class:"text-right"},c={key:0,class:"text-success"},u={key:1,class:"text-muted"},m={class:"d-none d-sm-block"},p={class:"btn-group"},g=["onClick"],b=["onClick"];function _(e,t,a,_,h,f){const P=(0,l.up)("Loading"),y=(0,l.up)("Pagination"),v=(0,l.up)("ProductModal"),w=(0,l.up)("DelModal");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(P,{loading:h.isLoading},null,8,["loading"]),(0,l._)("div",o,[(0,l._)("button",{class:"btn btn-outline-primary mt-2",type:"button",onClick:t[0]||(t[0]=e=>f.openProductModal(!0))},"新增產品")]),(0,l._)("table",i,[r,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(h.products,(t=>((0,l.wg)(),(0,l.iD)("tr",{key:t.id},[(0,l._)("td",null,(0,s.zw)(t.category),1),(0,l._)("td",null,(0,s.zw)(t.title),1),(0,l._)("td",d,(0,s.zw)(e.$filters.currency(t.origin_price)),1),(0,l._)("td",n,(0,s.zw)(e.$filters.currency(t.price)),1),(0,l._)("td",null,[t.is_enabled?((0,l.wg)(),(0,l.iD)("span",c,"啟用")):((0,l.wg)(),(0,l.iD)("span",u,"未啟用"))]),(0,l._)("td",m,[(0,l._)("div",p,[(0,l._)("button",{class:"btn btn-outline-info btn-sm",onClick:e=>f.openProductModal(!1,t)},"編輯",8,g),(0,l._)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>f.openDelProductModal(t)},"刪除",8,b)])])])))),128))])]),(0,l.Wm)(y,{pages:h.pagination,onEmitPages:f.getProducts},null,8,["pages","onEmitPages"]),(0,l.Wm)(v,{product:h.tempProduct,ref:"productModal",onUpdateProduct:f.upsertProduct},null,8,["product","onUpdateProduct"]),(0,l.Wm)(w,{item:h.tempProduct,ref:"delModal",onDelItem:f.delProduct},null,8,["item","onDelItem"])],64)}a(1703);var h=a(9242);const f={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal",role:"dialog"},P={class:"modal-content border-0"},y=(0,l._)("div",{class:"modal-header bg-primary text-white"},[(0,l._)("h5",{class:"modal-title",id:"exampleModalLabel"}," 產品 "),(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),v={class:"modal-body"},w={class:"row"},k={class:"col-sm-4"},U={class:"mb-3"},$={for:"image",class:"form-label d-block"},x=(0,l.Uk)(" 輸入圖片網址 "),M={class:"mb-3"},C={for:"customFile",class:"form-label"},V=(0,l.Uk)("或 上傳圖片 "),D=["src"],W={key:0,class:"mt-5"},Z=["onUpdate:modelValue"],F=["onClick"],L={class:"col-sm-8"},q={class:"mb-3"},z=(0,l._)("label",{for:"title",class:"form-label"},[(0,l.Uk)("標題"),(0,l._)("span",{class:"text-danger ms-1"},"*")],-1),E={class:"row gx-2"},H={class:"mb-3 col-md-6"},I=(0,l._)("label",{for:"category",class:"form-label"},[(0,l.Uk)("分類 "),(0,l._)("span",{class:"text-danger ms-1"},"*")],-1),N={class:"mb-3 col-md-6"},O=(0,l._)("label",{for:"price",class:"form-label"},[(0,l.Uk)("單位 "),(0,l._)("span",{class:"text-danger ms-1"},"*")],-1),Y={class:"row gx-2"},K={class:"mb-3 col-md-6"},j=(0,l._)("label",{for:"origin_price",class:"form-label"},[(0,l.Uk)("原價 "),(0,l._)("span",{class:"text-danger ms-1"},"*")],-1),S={class:"mb-3 col-md-6"},A=(0,l._)("label",{for:"price",class:"form-label"},[(0,l.Uk)("售價 "),(0,l._)("span",{class:"text-danger ms-1"},"*")],-1),B=(0,l._)("hr",null,null,-1),G={class:"mb-3"},J={for:"description",class:"form-label d-block"},Q=(0,l.Uk)("產品描述 "),R={class:"mb-3"},T={for:"content",class:"form-label d-block"},X=(0,l.Uk)("說明內容 "),ee={class:"mb-3"},te={class:"form-check"},ae={class:"form-check-label",for:"is_enabled"},le=(0,l.Uk)(" 是否啟用 "),se=(0,l._)("div",{class:"modal-footer"},[(0,l._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 "),(0,l._)("button",{type:"submit",class:"btn btn-outline-primary"},"確認")],-1);function oe(e,t,a,o,i,r){const d=(0,l.up)("v-field"),n=(0,l.up)("error-message"),c=(0,l.up)("v-form");return(0,l.wg)(),(0,l.iD)("div",f,[(0,l.Wm)(c,{class:"modal-dialog modal-xl",role:"document",onSubmit:t[11]||(t[11]=t=>e.$emit("update-product",i.tempProduct))},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",P,[y,(0,l._)("div",v,[(0,l._)("div",w,[(0,l._)("div",k,[(0,l._)("div",U,[(0,l._)("label",$,[x,(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[0]||(t[0]=e=>i.tempProduct.imageUrl=e),placeholder:"請輸入圖片連結"},null,512),[[h.nr,i.tempProduct.imageUrl]])])]),(0,l._)("div",M,[(0,l._)("label",C,[V,(0,l._)("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:t[1]||(t[1]=(...e)=>r.uploadFile&&r.uploadFile(...e))},null,544)])]),(0,l._)("img",{class:"img-fluid",src:i.tempProduct.imageUrl,alt:""},null,8,D),i.tempProduct.imageUrl?((0,l.wg)(),(0,l.iD)("div",W,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(i.tempProduct.imagesUrl,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"mb-3 input-group",key:t},[(0,l.wy)((0,l._)("input",{type:"url",class:"form-control form-control",placeholder:"請輸入連結","onUpdate:modelValue":e=>i.tempProduct.imagesUrl[t]=e},null,8,Z),[[h.nr,i.tempProduct.imagesUrl[t]]]),(0,l._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>i.tempProduct.imagesUrl.splice(t,1)}," 移除 ",8,F)])))),128)),(0,l._)("div",null,[(0,l._)("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:t[2]||(t[2]=e=>i.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])])):(0,l.kq)("",!0)]),(0,l._)("div",L,[(0,l._)("div",q,[z,(0,l.Wm)(d,{type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["標題"]}]),id:"title",name:"標題",rules:"required",placeholder:"請輸入標題 (必填)",modelValue:i.tempProduct.title,"onUpdate:modelValue":t[3]||(t[3]=e=>i.tempProduct.title=e)},null,8,["class","modelValue"]),(0,l.Wm)(n,{class:"invalid-feedback",name:"標題"})]),(0,l._)("div",E,[(0,l._)("div",H,[I,(0,l.Wm)(d,{type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["分類"]}]),id:"category",name:"分類",rules:"required",modelValue:i.tempProduct.category,"onUpdate:modelValue":t[4]||(t[4]=e=>i.tempProduct.category=e),placeholder:"請輸入分類 (必填)"},null,8,["class","modelValue"]),(0,l.Wm)(n,{class:"invalid-feedback",name:"分類"})]),(0,l._)("div",N,[O,(0,l.Wm)(d,{type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["單位"]}]),id:"unit",name:"單位",rules:"required",modelValue:i.tempProduct.unit,"onUpdate:modelValue":t[5]||(t[5]=e=>i.tempProduct.unit=e),placeholder:"請輸入單位 (必填)"},null,8,["class","modelValue"]),(0,l.Wm)(n,{class:"invalid-feedback",name:"單位"})])]),(0,l._)("div",Y,[(0,l._)("div",K,[j,(0,l.Wm)(d,{type:"number",class:(0,s.C_)(["form-control",{"is-invalid":e["原價"]}]),id:"origin_price",name:"原價",rules:"required",modelValue:i.tempProduct.origin_price,"onUpdate:modelValue":t[6]||(t[6]=e=>i.tempProduct.origin_price=e),modelModifiers:{number:!0},placeholder:"請輸入原價 (必填)"},null,8,["class","modelValue"]),(0,l.Wm)(n,{class:"invalid-feedback",name:"原價"})]),(0,l._)("div",S,[A,(0,l.Wm)(d,{type:"number",class:(0,s.C_)(["form-control",{"is-invalid":e["售價"]}]),id:"price",name:"售價",rules:"required",modelValue:i.tempProduct.price,"onUpdate:modelValue":t[7]||(t[7]=e=>i.tempProduct.price=e),modelModifiers:{number:!0},placeholder:"請輸入售價 (必填)"},null,8,["class","modelValue"]),(0,l.Wm)(n,{class:"invalid-feedback",name:"售價"})])]),B,(0,l._)("div",G,[(0,l._)("label",J,[Q,(0,l.wy)((0,l._)("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":t[8]||(t[8]=e=>i.tempProduct.description=e),placeholder:"請輸入產品描述"},null,512),[[h.nr,i.tempProduct.description]])])]),(0,l._)("div",R,[(0,l._)("label",T,[X,(0,l.wy)((0,l._)("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":t[9]||(t[9]=e=>i.tempProduct.content=e),placeholder:"請輸入產品說明內容"},null,512),[[h.nr,i.tempProduct.content]])])]),(0,l._)("div",ee,[(0,l._)("div",te,[(0,l._)("label",ae,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[10]||(t[10]=e=>i.tempProduct.is_enabled=e)},null,512),[[h.e8,i.tempProduct.is_enabled]]),le])])])])])]),se])])),_:1})],512)}var ie=a(1339),re=a(2734),de={props:{product:{type:Object,default(){return{}}}},watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])}},data(){return{modal:{},tempProduct:{}}},mixins:[ie.Z],methods:{async uploadFile(){try{const e=this.$refs.fileInput.files[0],t=new FormData;t.append("file-to-upload",e);const a=`${this.$apiUrl}/admin/upload`,l=await this.$http.post(a,t);l.data.success?this.tempProduct.imageUrl=l.data.imageUrl:this.$alert("上傳檔案格式錯誤或檔案過大，請選擇其它檔案並再次嘗試。")}catch(e){(0,re.Z)(this.$alert,e.message)}}}},ne=a(89);const ce=(0,ne.Z)(de,[["render",oe]]);var ue=ce,me=a(6076),pe=a(1979),ge=a(1870),be={data(){return{products:[],pagination:{},tempProduct:{},isNew:!1,isLoading:!1}},components:{ProductModal:ue,DelModal:me.Z,Pagination:pe.Z,Loading:ge.Z},methods:{async getProducts(e=1){try{const t=`${this.$apiUrl}/admin/products?page=${e}`;this.isLoading=!0;const a=await this.$http.get(t);if(!a.data.success)throw new Error("updateOrderFailed");this.products=a.data.products,this.pagination=a.data.pagination}catch(t){(0,re.Z)(this.$alert,t.message)}finally{this.isLoading=!1}},openProductModal(e,t){this.tempProduct=e?{}:{...t},this.isNew=e;const a=this.$refs.productModal;a.showModal()},async upsertProduct(e){try{this.tempProduct=e;let t="post",a=`${this.$apiUrl}/admin/product`,l=1;this.isNew||(a=`${this.$apiUrl}/admin/product/${e.id}`,t="put",l=this.pagination.current_page);const s=await this.$http[t](a,{data:this.tempProduct});if(!s.data.success)throw new Error("updateOrderFailed");await this.getProducts(l)}catch(t){(0,re.Z)(this.$alert,t.message)}finally{const e=this.$refs.productModal;e.hideModal()}},openDelProductModal(e){this.tempProduct={...e};const t=this.$refs.delModal;t.showModal()},async delProduct(){try{const e=`${this.$apiUrl}/admin/product/${this.tempProduct.id}`,t=await this.$http.delete(e);if(!t.data.success)throw new Error("updateOrderFailed");await this.getProducts(this.pagination.current_page)}catch(e){(0,re.Z)(this.$alert,e.message)}finally{const e=this.$refs.delModal;e.hideModal()}}},async mounted(){await this.getProducts()}};const _e=(0,ne.Z)(be,[["render",_]]);var he=_e}}]);
//# sourceMappingURL=325.1cf36565.js.map