"use strict";(self["webpackChunke_commerce"]=self["webpackChunke_commerce"]||[]).push([[764],{1764:function(e,o,t){t.r(o),t.d(o,{default:function(){return T}});var a=t(3396),n=t(7139);const l={class:"text-end"},s={class:"table mt-4"},i=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"名稱"),(0,a._)("th",null,"折扣百分比"),(0,a._)("th",null,"到期日"),(0,a._)("th",null,"是否啟用"),(0,a._)("th",null,"編輯")])],-1),d={key:0,class:"text-success"},u={key:1,class:"text-muted"},p={class:"btn-group"},c=["onClick"],r=["onClick"];function m(e,o,t,m,h,_){const b=(0,a.up)("VLoading"),C=(0,a.up)("Pagination"),g=(0,a.up)("CouponModal"),f=(0,a.up)("DelModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(b,{active:h.isLoading},null,8,["active"]),(0,a._)("div",null,[(0,a._)("div",l,[(0,a._)("button",{class:"btn btn-outline-primary mt-2",onClick:o[0]||(o[0]=e=>_.openCouponModal(!0))}," 新增優惠券 ")]),(0,a._)("table",s,[i,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.coupons,((o,t)=>((0,a.wg)(),(0,a.iD)("tr",{key:t},[(0,a._)("td",null,(0,n.zw)(o.title),1),(0,a._)("td",null,(0,n.zw)(o.percent)+"%",1),(0,a._)("td",null,(0,n.zw)(e.$filters.date(o.due_date)),1),(0,a._)("td",null,[o.is_enabled?((0,a.wg)(),(0,a.iD)("span",d,"啟用")):((0,a.wg)(),(0,a.iD)("span",u,"未起用"))]),(0,a._)("td",null,[(0,a._)("div",p,[(0,a._)("button",{class:"btn btn-outline-info btn-sm",onClick:e=>_.openCouponModal(!1,o)},"編輯",8,c),(0,a._)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>_.openDelCouponModal(o)},"刪除",8,r)])])])))),128))])])]),(0,a.Wm)(C,{pages:h.pagination,onEmitPages:_.getCoupons},null,8,["pages","onEmitPages"]),(0,a.Wm)(g,{coupon:h.tempCoupon,ref:"couponModal",onUpdateCoupon:_.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,a.Wm)(f,{item:h.tempCoupon,ref:"delModal",onDelItem:_.delCoupon},null,8,["item","onDelItem"])],64)}var h=t(9242);const _={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal",role:"dialog"},b={class:"modal-content border-0"},C=(0,a._)("div",{class:"modal-header bg-primary text-white"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"}," 優惠券 "),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),g={class:"modal-body"},f={class:"mb-3"},v=(0,a._)("label",{for:"title"},[(0,a.Uk)("標題"),(0,a._)("span",{class:"text-danger ms-1"},"*")],-1),M={class:"mb-3"},k=(0,a._)("label",{for:"coupon_code"},[(0,a.Uk)("優惠碼"),(0,a._)("span",{class:"text-danger ms-1"},"*")],-1),w={class:"mb-3"},y=(0,a._)("label",{for:"due_date"},[(0,a.Uk)("到期日"),(0,a._)("span",{class:"text-danger ms-1"},"*")],-1),x={class:"mb-3"},$=(0,a._)("label",{for:"price"},[(0,a.Uk)("折扣百分比"),(0,a._)("span",{class:"text-danger ms-1"},"*")],-1),D={class:"mb-3"},V={class:"form-check"},W=(0,a._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),U=(0,a._)("div",{class:"modal-footer"},[(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消"),(0,a._)("button",{type:"submit",class:"btn btn-primary"},"確認 ")],-1);function L(e,o,t,l,s,i){const d=(0,a.up)("v-field"),u=(0,a.up)("error-message"),p=(0,a.up)("v-form");return(0,a.wg)(),(0,a.iD)("div",_,[(0,a.Wm)(p,{class:"modal-dialog",role:"document",onSubmit:o[5]||(o[5]=o=>e.$emit("update-coupon",s.tempCoupon))},{default:(0,a.w5)((({errors:e})=>[(0,a._)("div",b,[C,(0,a._)("div",g,[(0,a._)("div",f,[v,(0,a.Wm)(d,{type:"text",class:(0,n.C_)(["form-control",{"is-invalid":e["標題"]}]),id:"title",name:"標題",rules:"required",modelValue:s.tempCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=e=>s.tempCoupon.title=e),placeholder:"請輸入標題(必填)"},null,8,["class","modelValue"]),(0,a.Wm)(u,{class:"invalid-feedback",name:"標題"})]),(0,a._)("div",M,[k,(0,a.Wm)(d,{type:"text",class:(0,n.C_)(["form-control",{"is-invalid":e["優惠碼"]}]),id:"coupon_code",name:"優惠碼",rules:"required",modelValue:s.tempCoupon.code,"onUpdate:modelValue":o[1]||(o[1]=e=>s.tempCoupon.code=e),placeholder:"請輸入優惠碼(必填)"},null,8,["class","modelValue"]),(0,a.Wm)(u,{class:"invalid-feedback",name:"優惠碼"})]),(0,a._)("div",w,[y,(0,a.Wm)(d,{type:"date",class:(0,n.C_)(["form-control",{"is-invalid":e["到期日"]}]),id:"due_date",name:"到期日",rules:"required",value:s.due_date[0],modelValue:s.due_date,"onUpdate:modelValue":o[2]||(o[2]=e=>s.due_date=e)},null,8,["class","value","modelValue"]),(0,a.Wm)(u,{class:"invalid-feedback",name:"到期日"})]),(0,a._)("div",x,[$,(0,a.Wm)(d,{type:"number",class:(0,n.C_)(["form-control",{"is-invalid":e["折扣百分比"]}]),id:"price",name:"折扣百分比",rules:"required",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":o[3]||(o[3]=e=>s.tempCoupon.percent=e),modelModifiers:{number:!0},placeholder:"請輸入折扣百分比(必填)"},null,8,["class","modelValue"]),(0,a.Wm)(u,{class:"invalid-feedback",name:"折扣百分比"})]),(0,a._)("div",D,[(0,a._)("div",V,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":o[4]||(o[4]=e=>s.tempCoupon.is_enabled=e)},null,512),[[h.e8,s.tempCoupon.is_enabled]]),W])])]),U])])),_:1})],512)}var Z=t(1339),q={props:{coupon:{}},data(){return{modal:{},tempCoupon:{},due_date:""}},watch:{coupon(){this.tempCoupon=this.coupon;const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");this.due_date=e},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[Z.Z]},P=t(89);const z=(0,P.Z)(q,[["render",L]]);var I=z,N=t(9316),S=t(1979),E={data(){return{coupons:[],tempCoupon:{},pagination:{},isNew:!1,isLoading:!1}},components:{CouponModal:I,DelModal:N.Z,Pagination:S.Z},methods:{getCoupons(e=1){const o=`https://vue3-course-api.hexschool.io/api/noi-api/admin/coupons?page=${e}`;this.isLoading=!0,this.$http.get(o).then((e=>{this.isLoading=!1,e.data.success&&(this.coupons=e.data.coupons,this.pagination=e.data.pagination)})).catch((()=>{this.isLoading=!1,this.$alert("sorry，目前服務不可用，請稍後再試或聯絡管理員。")}))},openCouponModal(e,o){this.tempCoupon=e?{due_date:(new Date).getTime()/1e3,is_enabled:0,percent:100}:{...o},this.isNew=e;const t=this.$refs.couponModal;t.showModal()},updateCoupon(e){this.tempCoupon=e;const o=this.$refs.couponModal;if(this.isNew){const e="https://vue3-course-api.hexschool.io/api/noi-api/admin/coupon",t="post";this.$http[t](e,{data:this.tempCoupon}).then((()=>{o.hideModal(),this.getCoupons()})).catch((()=>{this.$alert("sorry，目前服務不可用，請稍後再試或聯絡管理員。")}))}const t=`https://vue3-course-api.hexschool.io/api/noi-api/admin/coupon/${e.id}`,a="put";this.$http[a](t,{data:this.tempCoupon}).then((()=>{o.hideModal(),this.getCoupons(this.pagination.current_page)})).catch((()=>{this.$alert("sorry，目前服務不可用，請稍後再試或聯絡管理員。")}))},openDelCouponModal(e){this.tempCoupon={...e};const o=this.$refs.delModal;o.showModal()},delCoupon(){const e=`https://vue3-course-api.hexschool.io/api/noi-api/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(e).then((()=>{const e=this.$refs.delModal;e.hideModal(),this.getCoupons(this.pagination.current_page)})).catch((()=>{this.$alert("sorry，目前服務不可用，請稍後再試或聯絡管理員。")}))}},created(){this.getCoupons()}};const H=(0,P.Z)(E,[["render",m]]);var T=H}}]);
//# sourceMappingURL=764.66d13848.js.map